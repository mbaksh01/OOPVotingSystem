@page "/login"

@if (!_signingUp)
{
<h3>Sign In</h3>

<Paragraph>
    Don't have an account? Click <Anchor Clicked="@(() => _signingUp = true)">here</Anchor> to register.
</Paragraph>

<hr />

    @if (_justSignedUp)
    {
        <Paragraph>
            You have successfully registered your account.
            Login with the credentials you just used to sign up.
        </Paragraph>
    }

<Validations>
    <Validation Validator="ValidationRule.IsNotEmpty">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is1">Username</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is3">
                <TextEdit @bind-Text="_user.Username" Placeholder="Username"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Validation Validator="ValidationRule.IsAlphanumericWithUnderscore">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is1">Password</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is3">
                <TextEdit Role="TextRole.Password" @bind-Text="_user.Password" Placeholder="Password"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Button Clicked="SignIn"
            Border="Border.Is1.Rounded"
            Margin="Margin.Is2.OnY"
            Background="Background.Primary"
            TextColor="TextColor.White">
        Sign In
    </Button>
    <FieldBody>
        @if (_errorMessage is not null)
        {
            <Paragraph>@_errorMessage</Paragraph>
        }
    </FieldBody>
</Validations>
}
else
{
<h3>Sign Up</h3>

<Paragraph>
    Already have an account? Click <Anchor Clicked="@(() => _signingUp = false)">here</Anchor> to sign in.
</Paragraph>

<hr />

<h4>Personal Details</h4>

<Validations>
    <Validation Validator="ValidationRule.IsNotEmpty">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Name</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit @bind-Text="_user.Person.Name" Placeholder="Full Name"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Validation UsePattern>
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Phone Number</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit
                    Pattern="[0-9]*"
                    Role="TextRole.Telephone" 
                    @bind-Text="_user.Person.PhoneNumber" 
                    Placeholder="Phone number"/>
            </FieldBody>
        </Field>
    </Validation>
    <Validation Validator="ValidationRule.IsEmail">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Email</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit Role="TextRole.Email" @bind-Text="_user.Person.Email" Placeholder="Email"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Validation Validator="ValidationRule.IsAlpha">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Unique Person Identifier</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit
                    @bind-Text="_user.Person.UniquePersonIdentifier"
                    Placeholder="UNI"/>
            </FieldBody>
        </Field>
    </Validation>
    <Field Horizontal>
        <FieldLabel ColumnSize="ColumnSize.Is2" Padding="Padding.Is3.FromEnd"></FieldLabel>
        <FieldBody ColumnSize="ColumnSize.Is4" Display="Display.Flex" Flex="Flex.AlignItems.Center">
            <Check TValue="bool" @bind-Checked="_user.Person.AcceptedTerms">
                I have read and accepted the terms and conditions.
            </Check>
        </FieldBody>
    </Field>
</Validations>
    
<h4>Address</h4>

<Validations>
    <Validation Validator="ValidationRule.IsAlphanumeric">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Street1</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit @bind-Text="_user.Person.Address.Street1" Placeholder="Street 1"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Validation UsePattern>
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Street2</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit
                    Pattern="[a-zA-Z]*"
                    @bind-Text="_user.Person.Address.Street2"
                    Placeholder="Street 2"/>
            </FieldBody>
        </Field>
    </Validation>
    <Validation Validator="ValidationRule.IsAlpha">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">City</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit @bind-Text="_user.Person.Address.City" Placeholder="City"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Validation UsePattern>
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">State</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit 
                    Pattern="[a-zA-Z]*"
                    @bind-Text="_user.Person.Address.State"
                    Placeholder="State"/>
            </FieldBody>
        </Field>
    </Validation>
    <Validation Validator="ValidationRule.IsAlphanumeric">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Postal Code</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit @bind-Text="_user.Person.Address.PostalCode" Placeholder="Postal Code"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Validation Validator="ValidationRule.IsAlpha">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">County</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit @bind-Text="_user.Person.Address.Country" Placeholder="County"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
</Validations>

<h4>Sign In Details</h4>

<Validations>
    <Validation Validator="ValidationRule.IsNotEmpty">
            <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Username</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit @bind-Text="_user.Username" Placeholder="Username"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Validation Validator="ValidationRule.IsAlphanumericWithUnderscore">
        <Field Horizontal>
            <FieldLabel ColumnSize="ColumnSize.Is2">Password</FieldLabel>
            <FieldBody ColumnSize="ColumnSize.Is4">
                <TextEdit Role="TextRole.Password" @bind-Text="_user.Password" Placeholder="Password"></TextEdit>
            </FieldBody>
        </Field>
    </Validation>
    <Button Clicked="Register"
            Border="Border.Is1.Rounded"
            Margin="Margin.Is2.OnY"
            Background="Background.Primary"
            TextColor="TextColor.White">
        Register
    </Button>
</Validations>

}
